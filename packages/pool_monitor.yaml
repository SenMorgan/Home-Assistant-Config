######################################################################
# File: pool_monitor.yaml                                            #
# Author: SenMorgan https://github.com/SenMorgan                     #
# Date: 2026-02-08                                                   #
#                                                                    #
# Copyright (c) 2026 Sen Morgan                                      #
######################################################################

###############################################
## MQTT Sensors
###############################################
mqtt:
  sensor:
    - name: "Battery Voltage"
      unique_id: "battery_voltage"
      icon: mdi:battery
      device_class: voltage
      state_topic: "/pool-thermometer/vcc"
      value_template: "{{ value }}"
      unit_of_measurement: "mV"
      device:
        identifiers: ["pool_monitor"]
        name: "Pool Monitor"
        manufacturer: "üë®‚Äçüíª SenMorgan"
        model: "Pool Monitor"
        suggested_area: "Backyard"

    - name: "Upper Water Temperature"
      unique_id: "upper_water_temperature"
      icon: mdi:temperature-celsius
      device_class: temperature
      state_topic: "/pool-thermometer/ds18b20/upper-water-temp"
      value_template: "{{ value }}"
      unit_of_measurement: "¬∞C"
      device:
        identifiers: ["pool_monitor"]

    - name: "Bottom Water Temperature"
      unique_id: "bottom_water_temperature"
      icon: mdi:temperature-celsius
      device_class: temperature
      state_topic: "/pool-thermometer/ds18b20/bottom-water-temp"
      value_template: "{{ (value  | float(0) - 0.33)  | round(2, default=none)}}"
      unit_of_measurement: "¬∞C"
      device:
        identifiers: ["pool_monitor"]

    - name: "Air Temperature"
      unique_id: "air_temperature"
      icon: mdi:temperature-celsius
      state_topic: "/pool-thermometer/bme280/temp"
      device_class: temperature
      value_template: "{{ value }}"
      unit_of_measurement: "¬∞C"
      device:
        identifiers: ["pool_monitor"]

    - name: "Air Pressure"
      unique_id: "air_pressure"
      state_topic: "/pool-thermometer/bme280/press"
      device_class: pressure
      value_template: "{{ value }}"
      unit_of_measurement: "hPa"
      device:
        identifiers: ["pool_monitor"]

    - name: "Air Humidity"
      unique_id: "air_humidity"
      icon: mdi:water-percent
      state_topic: "/pool-thermometer/bme280/hum"
      device_class: humidity
      value_template: "{{ value }}"
      unit_of_measurement: "%"
      device:
        identifiers: ["pool_monitor"]

###############################################
## Compensation Sensors for Calculating Battery SoC
###############################################
compensation:
  pool_monitor_battery_soc:
    name: "Pool Monitor Battery SoC"
    source: sensor.pool_monitor_battery_voltage
    device_class: battery
    unit_of_measurement: "%"
    upper_limit: true
    lower_limit: true
    precision: 0
    data_points:
      - [4200, 100]
      - [4150, 95]
      - [4110, 90]
      - [4080, 85]
      - [4020, 80]
      - [3980, 75]
      - [3950, 70]
      - [3910, 65]
      - [3870, 60]
      - [3850, 55]
      - [3840, 50]
      - [3820, 45]
      - [3800, 40]
      - [3790, 35]
      - [3770, 30]
      - [3750, 25]
      - [3730, 20]
      - [3710, 15]
      - [3690, 10]
      - [3610, 5]
      - [3270, 0]
